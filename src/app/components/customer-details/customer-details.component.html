<!-- src/app/components/customer-details/customer-details.component.html -->
<div class="booking-checkout-container">
  <!-- Header -->
  <div class="checkout-header">
    <div class="progress-steps">
      <div class="step active">
        <span class="step-number">1</span>
        <span class="step-label">Ẩm thực</span>
      </div>
      <div class="step active">
        <span class="step-number">2</span>
        <span class="step-label">Thông tin</span>
      </div>
      <div class="step">
        <span class="step-number">3</span>
        <span class="step-label">Thanh toán</span>
      </div>
    </div>
  </div>

  <div class="checkout-content">
    <!-- Left Column - Form -->
    <div class="form-section">
      <!-- Timer Warning -->
      <div class="timer-warning">
        <i class="fas fa-clock"></i>
        <span>Chúng tôi sẽ giữ chỗ cho bạn trong <strong>{{ formatTime(timeLeft) }} phút</strong></span>
      </div>

      <!-- Security Badge -->
      <div class="security-badge">
        <i class="fas fa-shield-alt"></i>
        <span>Thanh toán nhanh chóng và bảo mật</span>
      </div>

      <!-- Customer Details Form -->
      <form [formGroup]="customerForm" class="customer-form" (ngSubmit)="onSubmit()">
        <h2>Nhập thông tin cá nhân của bạn</h2>
        
        <!-- Required Fields Notice -->
        <p class="required-notice">
          <span class="required-asterisk">*</span> Các trường bắt buộc
        </p>

        <!-- Full Name Field -->
        <div class="form-group">
          <label for="fullName">
            Họ và tên<span class="required-asterisk">*</span>
          </label>
          <input 
            type="text"
            id="fullName"
            formControlName="fullName"
            class="form-control"
            [class.valid]="customerForm.get('fullName')?.valid && customerForm.get('fullName')?.touched"
            [class.error]="customerForm.get('fullName')?.invalid && customerForm.get('fullName')?.touched"
            placeholder="Nguyễn Văn Nam"
          >
          <div class="success-indicator" *ngIf="customerForm.get('fullName')?.valid && customerForm.get('fullName')?.touched">
            <i class="fas fa-check"></i>
          </div>
          <div class="error-message" *ngIf="customerForm.get('fullName')?.invalid && customerForm.get('fullName')?.touched">
            Vui lòng nhập họ và tên hợp lệ
          </div>
        </div>

        <!-- Email Field -->
        <div class="form-group">
          <label for="email">
            Email<span class="required-asterisk">*</span>
          </label>
          <input 
            type="email"
            id="email"
            formControlName="email"
            class="form-control"
            [class.valid]="customerForm.get('email')?.valid && customerForm.get('email')?.touched"
            [class.error]="customerForm.get('email')?.invalid && customerForm.get('email')?.touched"
            placeholder="example@gmail.com"
          >
          <div class="success-indicator" *ngIf="customerForm.get('email')?.valid && customerForm.get('email')?.touched">
            <i class="fas fa-check"></i>
          </div>
          <div class="error-message" *ngIf="customerForm.get('email')?.invalid && customerForm.get('email')?.touched">
            Vui lòng nhập địa chỉ email hợp lệ
          </div>
        </div>

        <!-- Country Field -->
        <div class="form-group">
          <label for="country">
            Quốc gia<span class="required-asterisk">*</span>
          </label>
          <select 
            id="country"
            formControlName="country"
            class="form-control"
            [class.valid]="customerForm.get('country')?.valid"
            [class.error]="customerForm.get('country')?.invalid && customerForm.get('country')?.touched"
          >
            <option value="">Chọn quốc gia</option>
            <option *ngFor="let country of countries" [value]="country.code">
              {{ country.flag }} {{ country.name }} ({{ country.dialCode }})
            </option>
          </select>
          <div class="success-indicator" *ngIf="customerForm.get('country')?.valid">
            <i class="fas fa-check"></i>
          </div>
          <div class="error-message" *ngIf="customerForm.get('country')?.invalid && customerForm.get('country')?.touched">
            Vui lòng chọn quốc gia
          </div>
        </div>

        <!-- Mobile Phone Field -->
        <div class="form-group">
          <label for="phone">
            Số điện thoại di động<span class="required-asterisk">*</span>
          </label>
          <input 
            type="tel"
            id="phone"
            formControlName="phone"
            class="form-control"
            [class.valid]="customerForm.get('phone')?.valid && customerForm.get('phone')?.touched"
            [class.error]="customerForm.get('phone')?.invalid && customerForm.get('phone')?.touched"
            placeholder="0903 102 269"
          >
          <div class="success-indicator" *ngIf="customerForm.get('phone')?.valid && customerForm.get('phone')?.touched">
            <i class="fas fa-check"></i>
          </div>
          <div class="error-message" *ngIf="customerForm.get('phone')?.invalid && customerForm.get('phone')?.touched">
            Vui lòng nhập số điện thoại hợp lệ
          </div>
          <p class="field-help">
            Chúng tôi sẽ chỉ liên hệ với bạn qua các cập nhật quan trọng hoặc thay đổi về đặt chỗ của bạn
          </p>
        </div>

        <!-- Date of Birth Field -->
        <div class="form-group">
          <label for="dateOfBirth">
            Ngày sinh
          </label>
          <input 
            type="date"
            id="dateOfBirth"
            formControlName="dateOfBirth"
            class="form-control"
          >
        </div>

        <!-- Company Field -->
        <div class="form-group">
          <label for="company">
            Công ty
          </label>
          <input 
            type="text"
            id="company"
            formControlName="company"
            class="form-control"
            placeholder="Tên công ty (tùy chọn)"
          >
        </div>

        <!-- Address Field -->
        <div class="form-group">
          <label for="address">
            Địa chỉ
          </label>
          <input 
            type="text"
            id="address"
            formControlName="address"
            class="form-control"
            placeholder="Địa chỉ của bạn"
          >
        </div>

        <!-- City and Postal Code Row -->
        <div class="form-row">
          <div class="form-group">
            <label for="city">
              Thành phố
            </label>
            <input 
              type="text"
              id="city"
              formControlName="city"
              class="form-control"
              placeholder="Hồ Chí Minh"
            >
          </div>
          <div class="form-group">
            <label for="postalCode">
              Mã bưu điện
            </label>
            <input 
              type="text"
              id="postalCode"
              formControlName="postalCode"
              class="form-control"
              placeholder="700000"
            >
          </div>
        </div>

        <!-- Preferred Language Field -->
        <div class="form-group">
          <label for="language">
            Ngôn ngữ ưa thích
          </label>
          <select 
            id="language"
            formControlName="language"
            class="form-control"
          >
            <option value="vi">Tiếng Việt</option>
            <option value="en">English</option>
            <option value="fr">Français</option>
            <option value="de">Deutsch</option>
            <option value="ja">日本語</option>
            <option value="ko">한국어</option>
            <option value="zh">中文</option>
          </select>
        </div>

        <!-- Special Requests Field -->
        <div class="form-group">
          <label for="specialRequests">
            Yêu cầu đặc biệt
          </label>
          <textarea 
            id="specialRequests"
            formControlName="specialRequests"
            class="form-control"
            rows="3"
            placeholder="Có yêu cầu đặc biệt nào không? (tùy chọn)"
          ></textarea>
        </div>

        <!-- Customer Source Tracking -->
        <div class="form-group">
          <label for="customerSource">
            Bạn biết đến chúng tôi qua đâu?
          </label>
          <select 
            id="customerSource"
            formControlName="customerSource"
            class="form-control"
          >
            <option value="">Chọn nguồn</option>
            <option value="google">Google Search</option>
            <option value="facebook">Facebook</option>
            <option value="instagram">Instagram</option>
            <option value="youtube">YouTube</option>
            <option value="friend">Bạn bè giới thiệu</option>
            <option value="blog">Blog/Website</option>
            <option value="travel-agent">Đại lý du lịch</option>
            <option value="other">Khác</option>
          </select>
        </div>

        <!-- Interest Categories for Marketing -->
        <div class="form-group">
          <label>Sở thích du lịch của bạn (chọn nhiều):</label>
          <div class="checkbox-group">
            <label class="checkbox-label" *ngFor="let interest of travelInterests">
              <input 
                type="checkbox" 
                [value]="interest.value"
                (change)="onInterestChange($event)"
              >
              <span class="checkbox-custom">
                <i class="fas fa-check"></i>
              </span>
              <span class="checkbox-text">{{ interest.label }}</span>
            </label>
          </div>
        </div>

        <!-- Marketing Consent -->
        <div class="consent-section">
          <p class="consent-intro">
            Đôi khi bạn có thể nhận được email khuyến mãi từ chúng tôi liên quan đến các hoạt động đã đặt hoặc các dịch vụ khác của GetYourGuide. 
            Chọn không tham gia bằng cách nhấp vào
            <a href="#" class="link">đây</a> hoặc bất kỳ lúc nào, như được nêu chi tiết trong
            <a href="#" class="link">Chính sách Bảo mật</a> của chúng tôi.
          </p>

          <label class="consent-checkbox">
            <input type="checkbox" formControlName="marketingConsent">
            <span class="checkbox-custom">
              <i class="fas fa-check"></i>
            </span>
            <span class="consent-text">Đăng ký nhận tin khuyến mãi và cập nhật từ GetYourGuide</span>
          </label>
        </div>

        <!-- Privacy Policy Agreement -->
        <div class="consent-section">
          <label class="consent-checkbox">
            <input type="checkbox" formControlName="privacyConsent">
            <span class="checkbox-custom">
              <i class="fas fa-check"></i>
            </span>
            <span class="consent-text">
              Tôi đồng ý với <a href="#" class="link">Điều khoản dịch vụ</a> và 
              <a href="#" class="link">Chính sách bảo mật</a> <span class="required-asterisk">*</span>
            </span>
          </label>
          <div class="error-message" *ngIf="customerForm.get('privacyConsent')?.invalid && customerForm.get('privacyConsent')?.touched">
            Vui lòng đồng ý với điều khoản dịch vụ
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="onBack()">
            <i class="fas fa-arrow-left"></i>
            Quay lại
          </button>
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="customerForm.invalid"
          >
            Đi tới thanh toán
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </form>
    </div>

    <!-- Right Column - Order Summary -->
    <div class="order-summary">
      <div class="summary-card">
        <h3>Tóm tắt đơn hàng</h3>
        
        <div class="tour-summary" *ngIf="tour">
          <img [src]="tour.imageUrl || defaultTourImage" [alt]="tour.name" class="tour-image">
          <div class="tour-info">
            <h4>{{ tour.name }}</h4>
            <div class="rating">
              <span class="stars">★★★★☆</span>
              <span class="rating-text">{{ tour.rating || '4.5' }} ({{ tour.reviewCount || '120' }})</span>
            </div>
            <div class="urgency-notice">
              <i class="fas fa-exclamation-circle"></i>
              <span>Chỉ còn {{ hoursLeft }} giờ để đặt</span>
            </div>
          </div>
        </div>

        <div class="booking-details">
          <div class="detail-row">
            <i class="fas fa-user-friends"></i>
            <span>{{ tourType }} • Ngôn ngữ: {{ tourLanguage }}</span>
          </div>
          <div class="detail-row">
            <i class="fas fa-calendar"></i>
            <span>{{ formatBookingDate() }}</span>
          </div>
          <div class="detail-row">
            <i class="fas fa-user"></i>
            <span>{{ numberOfPeople }} {{ numberOfPeople > 1 ? 'người' : 'người' }} ({{ ageRange }})</span>
          </div>
          <div class="detail-row change-link">
            <i class="fas fa-edit"></i>
            <a href="#" (click)="changeBookingDetails($event)">Thay đổi ngày hoặc số người tham gia</a>
          </div>
        </div>

        <div class="pricing-section">
          <div class="free-cancellation">
            <i class="fas fa-calendar-times"></i>
            <div>
              <strong>Hủy miễn phí</strong>
              <small>Đến {{ formatCancellationDeadline() }}</small>
            </div>
          </div>

          <div class="promo-section">
            <button class="promo-btn" (click)="togglePromoCode()">
              <i class="fas fa-tag"></i>
              Nhập mã khuyến mãi, tín dụng hoặc thẻ quà tặng
            </button>
            <div class="promo-input" *ngIf="showPromoInput">
              <input 
                type="text" 
                [(ngModel)]="promoCode" 
                placeholder="Nhập mã khuyến mãi"
                class="form-control"
              >
              <button class="btn btn-primary" (click)="applyPromoCode()">Áp dụng</button>
            </div>
          </div>

          <div class="total-section">
            <div class="price-breakdown" *ngIf="showPriceBreakdown">
              <div class="price-row">
                <span>Giá tour ({{ numberOfPeople }} người)</span>
                <span>{{ formatPrice(basePriceTotal) }}</span>
              </div>
              <div class="price-row" *ngIf="taxes > 0">
                <span>Thuế và phí</span>
                <span>{{ formatPrice(taxes) }}</span>
              </div>
              <div class="price-row discount-row" *ngIf="discount > 0">
                <span>Giảm giá</span>
                <span>-{{ formatPrice(discount) }}</span>
              </div>
            </div>
            <div class="total-row">
              <span class="total-label">Tổng cộng</span>
              <div class="total-amount">
                <span class="amount">{{ formatPrice(totalAmount) }}</span>
                <small>Đã bao gồm tất cả thuế và phí</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>