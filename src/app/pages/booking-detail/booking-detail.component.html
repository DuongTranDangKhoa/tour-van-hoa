<div class="booking-detail-page">
  <!-- Ph·∫ßn tr√™n: H√¨nh ·∫£nh tour -->
  <div class="tour-hero-section" *ngIf="tour">
    <div class="media-section">
      <!-- Left section - 50% -->
      <div class="main-image-section">
        <img [src]="tour.imageUrl" [alt]="tour.name" class="hero-image">
        <button class="play-button">
          <i class="icon">‚ñ∂Ô∏è</i>
        </button>
      </div>
      
      <!-- Right section - 50% divided into 4 equal parts -->
      <div class="image-grid-section">
        <div class="grid-item">
          <img [src]="tour.imageUrl" [alt]="tour.name">
          <div class="overlay-text">Tour VƒÉn H√≥a presents</div>
        </div>
        <div class="grid-item top-right-border">
          <img [src]="tour.imageUrl" [alt]="tour.name">
        </div>
        <div class="grid-item">
          <img [src]="tour.imageUrl" [alt]="tour.name">
        </div>
        <div class="grid-item bot-right-border">
          <img [src]="tour.imageUrl" [alt]="tour.name">
          <div class="gallery-btn">
            <i class="icon">üì∑</i>
            <span>Th∆∞ vi·ªán</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ph·∫ßn d∆∞·ªõi: Chia 2 c·ªôt -->
  <div class="main-content" *ngIf="tour">
    <!-- Left Panel: Th√¥ng tin tour -->
    <div class="tour-details-panel">
      <div class="event-title-section">
        <h1>{{ tour.name }}</h1>
        <div class="rating">
          <i class="icon">‚≠ê</i>
          <i class="icon">‚≠ê</i>
          <i class="icon">‚≠ê</i>
          <i class="icon">‚≠ê</i>
          <i class="icon">‚≠ê</i>
          <span>(4.5)</span>
        </div>
      </div>
      <div class="description-section">
        <h2>M√¥ t·∫£</h2>
        <p>{{ tour.description }}</p>
      </div>
      <div class="general-info-section">
        <h2>Th√¥ng tin chung</h2>
        <ul>
          <li><i class="icon">üìç</i> <strong>ƒêi·ªÉm ƒë·∫øn:</strong> {{ tour.destination }}</li>
          <li><i class="icon">‚è∞</i> <strong>Th·ªùi l∆∞·ª£ng:</strong> {{ tour.duration }}</li>
          <li><i class="icon">üë•</i> <strong>S·ªë ng∆∞·ªùi t·ªëi ƒëa:</strong> {{ tour.maxGroupSize }}</li>
          <li><i class="icon">üí∞</i> <strong>Gi√°:</strong> {{ tour.price | currency:'VND':'symbol':'1.0-0' }}</li>
          <li><i class="icon">üìÖ</i> <strong>Ng√†y kh·ªüi h√†nh:</strong> H√†ng ng√†y</li>
          <li><i class="icon">üåê</i> <strong>Ng√¥n ng·ªØ:</strong> Ti·∫øng Vi·ªát, Ti·∫øng Anh</li>
          <li><i class="icon">‚≠ê</i> <strong>ƒê·ªô kh√≥:</strong> {{ tour.difficulty }}</li>
        </ul>
      </div>
      <div class="programme-section">
        <h2>Ch∆∞∆°ng tr√¨nh tour</h2>
        <p>Chi ti·∫øt ch∆∞∆°ng tr√¨nh tour s·∫Ω ƒë∆∞·ª£c cung c·∫•p khi x√°c nh·∫≠n ƒë·∫∑t ch·ªó.</p>
      </div>
      <div class="user-reviews-section">
        <h2>User reviews</h2>
        <div class="reviews-header">
          <div class="score">
            <span class="score-value">4.8</span><span class="score-out-of">/5</span>
          </div>
          <div class="stars" aria-label="rating 5 stars">
            <i class="star">‚òÖ</i>
            <i class="star">‚òÖ</i>
            <i class="star">‚òÖ</i>
            <i class="star">‚òÖ</i>
            <i class="star">‚òÖ</i>
          </div>
          <div class="based-on">based on 29 reviews</div>
        </div>

        <div class="reviews-list">
          <div class="review-card">
            <div class="review-card-header">
              <div class="reviewer">Maechel D.</div>
              <div class="date">Jul 2025</div>
              <div class="stars small">
                <i>‚òÖ</i><i>‚òÖ</i><i>‚òÖ</i><i>‚òÖ</i><i>‚òÖ</i>
              </div>
            </div>
            <div class="review-text">
              Its magical and really breathless. The musical had really enjoying music, hope the time is more than one hour..
            </div>
          </div>

          <div class="review-card">
            <div class="review-card-header">
              <div class="reviewer">Alexandr...</div>
              <div class="date">Jul 2025</div>
              <div class="stars small">
                <i>‚òÖ</i><i>‚òÖ</i><i>‚òÖ</i><i>‚òÖ</i><i>‚òÖ</i>
              </div>
            </div>
            <div class="review-text">
              Very good and well organized. Great place and good music always match well.
            </div>
          </div>

          <div class="review-card">
            <div class="review-card-header">
              <div class="reviewer">Jun 2025</div>
              <div class="date">‚Äî</div>
              <div class="stars small">
                <i>‚òÖ</i><i>‚òÖ</i><i>‚òÖ</i><i>‚òÖ</i><i>‚òÖ</i>
              </div>
            </div>
            <div class="review-text">
              It was one of the most beautiful string concerts that I have ever gone to.
            </div>
          </div>
        </div>

        <div class="reviews-actions">
          <button type="button" class="view-all">View all reviews</button>
        </div>
      </div>
      <div class="map-section">
        <h2>B·∫£n ƒë·ªì</h2>
        <div class="map-embed">
          <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d236225.41396791287!2d103.74160180208737!3d22.315004187869228!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x36cd40a503ec6395%3A0x49032814dedb2fb8!2zU2EgUGEsIEzDoG8gQ2FpLCBWaeG7h3QgTmFt!5e0!3m2!1svi!2s!4v1755762959879!5m2!1svi!2s" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
      
    </div>

    <!-- Right Panel: Booking Widget - feverup style -->
    <div class="booking-widget">
      <form [formGroup]="bookingForm" (ngSubmit)="onBookTour()">
        <!-- Calendar Section -->
        <div class="calendar-section">
          <h3>Ch·ªçn ng√†y v√† gi·ªù</h3>
          <div class="month-nav">
            <button type="button" (click)="prevMonth()" class="nav-btn" [disabled]="!canGoPrevMonth()">‚Äπ</button>
            
            <!-- Hi·ªÉn th·ªã 3 th√°ng: prev, current, next -->
            <div class="month-buttons">
              <button type="button" 
                      (click)="selectMonth(availableMonths[getCurrentIndex() - 1].value || 0, availableMonths[getCurrentIndex() - 1].year || currentYear)" 
                      [disabled]="!canGoPrevMonth()"
                      class="month-btn">
                {{ canGoPrevMonth() ? availableMonths[getCurrentIndex() - 1].label : '---' }}
              </button>
              
              <button type="button" 
                      (click)="selectMonth(currentMonth, currentYear)" 
                      [class.active]="true"
                      class="month-btn">
                {{ getMonthLabel(currentMonth, currentYear) }}
              </button>
              
              <button type="button" 
                      (click)="selectMonth(availableMonths[getCurrentIndex() + 1].value || 0, availableMonths[getCurrentIndex() + 1].year || currentYear)" 
                      [disabled]="!canGoNextMonth()"
                      class="month-btn">
                {{ canGoNextMonth() ? availableMonths[getCurrentIndex() + 1].label : '---' }}
              </button>
            </div>
            
            <button type="button" (click)="nextMonth()" class="nav-btn" [disabled]="!canGoNextMonth()">‚Ä∫</button>
          </div>

          <div class="weekdays">
            <div class="day">SU</div>
            <div class="day">MO</div>
            <div class="day">TU</div>
            <div class="day">WE</div>
            <div class="day">TH</div>
            <div class="day">FR</div>
            <div class="day">SA</div>
          </div>

          <div class="calendar-days">
            <div class="day-cell" *ngFor="let day of days" 
                 [class.selected]="day.selected"
                 [class.low-availability]="day.availability === 'low'"
                 [class.best-price]="day.availability === 'best'"
                 [class.empty]="!day.day"
                 [class.disabled]="day.disabled"
                 (click)="selectDate(day)">
              <div class="corner-ribbon" *ngIf="day.selected"></div>
              <div class="day-number">{{ day.day }}</div>
              <!-- <div class="day-price" *ngIf="day.day && !day.disabled">${{ day.price }}</div> -->
              <div class="bottom-indicator"></div>
            </div>
          </div>

          <!-- Session Selection -->
          <div class="session-selection">
            <div class="session-header">
              <span>C√°c gi·ªù c√≥ s·∫µn</span>
              <div class="legend">
                <span class="legend-item"><span class="legend-line low"></span> Kh·∫£ d·ª•ng th·∫•p</span>
                <span class="legend-item"><span class="legend-line best"></span> Gi√° t·ªët</span>
              </div>
            </div>
            <div class="session-navigation">
              <button type="button" 
                      class="session-nav-btn" 
                      (click)="prevSession()" 
                      [disabled]="!canGoPrevSession()">
                ‚Äπ
              </button>
              
              <div class="session-buttons">
                <button type="button" 
                        class="session-btn" 
                        *ngFor="let session of getVisibleSessions()"
                        (click)="selectSession(session)"
                        [class.active]="selectedSession === session">
                  {{ session }}
                </button>
              </div>
              
              <button type="button" 
                      class="session-nav-btn" 
                      (click)="nextSession()" 
                      [disabled]="!canGoNextSession()">
                ‚Ä∫
              </button>
            </div>
          </div>
        </div>

        <!-- Ticket Selection -->
        <div class="ticket-selection">
          <div class="ticket-item" *ngFor="let ticket of tickets">
            <div class="ticket-left">
              <div class="ticket-header">
                <h4>{{ ticket.name }}</h4>
             
              </div>
              <div class="ticket-desc">
                <p>Ticket for 1 person, includes:</p>
                <ul>
                  <li>Admission into the experience</li>
                </ul>
              </div>
              <div class="ticket-price">
                <span class="price">{{ ticket.price | currency:'VND':'symbol':'1.0-0' }}</span>
                <span class="fee">+ {{ ticket.bookingFee | currency:'VND':'symbol':'1.0-0' }} ph√≠ ƒë·∫∑t v√©</span>
              </div>
            </div>
            <div class="ticket-right">
              <div class="quantity-selector">
                <button type="button" (click)="adjustQuantity(ticket.id, -1)" [disabled]="getTicketQuantity(ticket.id) === 0">‚àí</button>
                <span>{{ getTicketQuantity(ticket.id) }}</span>
                <button type="button" (click)="adjustQuantity(ticket.id, 1)">+</button>
              </div>
            </div>
          </div>

          <!-- Add-on -->
          <div class="add-on-item">
            <h4>Photo Opportunity</h4>
            <p>Capture the moment with a personalized 15x20 cm printed photo in a premium Jurassic World folder...</p>
            <a href="#" class="read-more">Xem th√™m</a>
            <div class="add-on-price">
              <span class="price">+ {{ addOnPrice | currency:'VND':'symbol':'1.0-0' }}</span>
            </div>
            <div class="quantity-selector">
              <button type="button" (click)="adjustAddOn(-1)" [disabled]="addOnQuantity === 0">‚àí</button>
              <span>{{ addOnQuantity }}</span>
              <button type="button" (click)="adjustAddOn(1)">+</button>
            </div>
          </div>

          <!-- Total Price -->
          <div class="total-price">
            <span>T·ªïng c·ªông:</span>
            <span class="amount">{{ getTotalPrice() | currency:'VND':'symbol':'1.0-0' }}</span>
          </div>

          <!-- Submit Button -->
          <button type="submit" class="book-button" [disabled]="isSubmitting || !selectedDate || !selectedSession">
            {{ getTotalPrice() | currency:'VND':'symbol':'1.0-0' }} ‚Äî ƒê·∫∑t ngay
          </button>
        </div>
      </form>
    </div>
  </div>
</div>